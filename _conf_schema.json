{
  "provider_settings": {
    "description": "模型提供商",
    "hint": "配置记忆系统使用的 AI 模型",
    "type": "object",
    "items": {
      "embedding_provider_id": {
        "description": "Embedding 模型 ID",
        "hint": "用于生成记忆向量的 Embedding 模型 ID。留空使用 AstrBot 默认。可在 AstrBot 后台「LLM 配置」中查看已有的 Embedding Provider ID（如 openai_embedding）。",
        "type": "string",
        "default": ""
      },
      "llm_provider_id": {
        "description": "LLM 模型 ID",
        "hint": "用于总结对话、评估记忆重要性的大语言模型 ID。留空使用 AstrBot 默认。推荐使用推理能力较强的模型。",
        "type": "string",
        "_special": "select_provider",
        "default": ""
      }
    }
  },
  "webui_settings": {
    "description": "WebUI 管理面板",
    "hint": "启用后可通过浏览器可视化管理记忆和会话",
    "type": "object",
    "items": {
      "enabled": {
        "description": "启用 WebUI",
        "hint": "开启后可通过浏览器访问记忆管理面板。",
        "type": "bool",
        "default": false
      },
      "host": {
        "description": "监听地址",
        "hint": "127.0.0.1 仅本机访问；0.0.0.0 允许局域网访问。",
        "type": "string",
        "default": "127.0.0.1"
      },
      "port": {
        "description": "监听端口",
        "hint": "WebUI 服务端口，确保不与 AstrBot 主端口（默认 6185）冲突。",
        "type": "int",
        "default": 8888
      },
      "access_password": {
        "description": "访问密码",
        "hint": "登录 WebUI 所需密码。留空时系统自动生成随机密码并在日志中提示。建议手动设置。",
        "type": "string",
        "obvious_hint": true,
        "default": ""
      },
      "session_timeout": {
        "description": "登录会话超时（秒）",
        "hint": "登录后的有效时长，超时需重新登录。默认 3600（1 小时）。",
        "type": "int",
        "default": 3600
      }
    }
  },
  "session_manager": {
    "description": "会话管理",
    "hint": "管理用户会话状态和对话历史的缓存行为",
    "type": "object",
    "items": {
      "max_sessions": {
        "description": "最大缓存会话数",
        "hint": "内存中同时保留的最大会话数（LRU 淘汰）。超出后最久未使用的会话从缓存移除，但数据仍保存在数据库中。",
        "type": "int",
        "default": 100
      },
      "session_ttl": {
        "description": "会话空闲超时（秒）",
        "hint": "会话超过此时间无活动后从缓存移除。默认 3600（1 小时）。",
        "type": "int",
        "default": 3600
      },
      "context_window_size": {
        "description": "上下文窗口大小（条）",
        "hint": "传给 LLM 的最大历史消息条数。越大上下文越丰富，但消耗 token 越多。建议 20-100。",
        "type": "int",
        "default": 50
      }
    }
  },
  "recall_engine": {
    "description": "记忆召回",
    "hint": "控制记忆检索和注入到对话的行为",
    "type": "object",
    "items": {
      "top_k": {
        "description": "单次召回数量",
        "hint": "每次检索返回的最相关记忆条数。建议 3-10。",
        "type": "int",
        "default": 5
      },
      "importance_weight": {
        "description": "重要性权重",
        "hint": "混合评分中记忆重要性的占比系数。值越大，重要性高的记忆越优先被召回。",
        "type": "float",
        "default": 1.0
      },
      "fallback_to_vector": {
        "description": "降级到纯向量检索",
        "hint": "混合检索失败或结果为空时，自动降级为纯向量检索。建议开启。",
        "type": "bool",
        "default": true
      },
      "injection_method": {
        "description": "记忆注入位置",
        "hint": "记忆注入到 LLM 请求的位置。user_message_before：作为用户消息前缀；system_prompt：追加到系统提示词；user_message_after：作为用户消息后缀。",
        "type": "string",
        "default": "user_message_before",
        "options": [
          "user_message_before",
          "system_prompt",
          "user_message_after"
        ]
      },
      "auto_remove_injected": {
        "description": "自动清除旧注入片段",
        "hint": "注入新记忆前自动删除历史中已注入的旧记忆片段，避免重复累积和 token 浪费。建议开启。",
        "type": "bool",
        "default": true
      }
    }
  },
  "importance_decay": {
    "description": "重要性衰减",
    "hint": "随时间逐步降低旧记忆的重要性，防止旧信息长期占据高权重",
    "type": "object",
    "items": {
      "decay_rate": {
        "description": "每日衰减率",
        "hint": "每天对记忆重要性的衰减比例。0.01 表示每天降低 1%。设为 0 可禁用衰减。",
        "type": "float",
        "default": 0.01
      }
    }
  },
  "fusion_strategy": {
    "description": "检索融合策略",
    "hint": "BM25 和向量检索结果的融合参数（内部使用 RRF 算法）",
    "type": "object",
    "items": {
      "rrf_k": {
        "description": "RRF 融合参数 k",
        "hint": "值越小越强调排名靠前的结果，值越大融合越平滑。推荐 30-120，默认 60。",
        "type": "int",
        "default": 60
      }
    }
  },
  "filtering_settings": {
    "description": "记忆隔离设置",
    "type": "object",
    "items": {
      "use_persona_filtering": {
        "description": "按人格隔离记忆",
        "hint": "开启后只召回与当前人格相关的记忆，不同人格的记忆互不干扰。",
        "type": "bool",
        "default": true
      },
      "use_session_filtering": {
        "description": "按会话隔离记忆",
        "hint": "开启后每个会话的记忆独立存储，不同会话之间不共享记忆。",
        "type": "bool",
        "default": true
      }
    }
  },
  "reflection_engine": {
    "description": "记忆生成设置",
    "hint": "控制何时触发对话总结并生成记忆",
    "type": "object",
    "items": {
      "summary_trigger_rounds": {
        "description": "总结触发轮次",
        "hint": "累计对话达到该轮次（一问一答为一轮）后触发总结并写入记忆。",
        "type": "int",
        "default": 10
      },
      "save_original_conversation": {
        "description": "同时保存原始对话",
        "hint": "开启后在结构化摘要之外额外保存完整对话原文，适合需要完整上下文的场景，但会增加 60-80% 存储空间。默认关闭，只保存结构化摘要。",
        "type": "bool",
        "default": false
      }
    }
  },
  "migration_settings": {
    "description": "数据库迁移",
    "hint": "控制插件启动时的数据库版本升级行为",
    "type": "object",
    "items": {
      "auto_migrate": {
        "description": "自动迁移",
        "hint": "插件启动时自动检测并升级旧版本数据库。建议保持开启。",
        "type": "bool",
        "default": true
      },
      "create_backup": {
        "description": "迁移前自动备份",
        "hint": "执行数据库迁移前自动创建备份文件，防止迁移失败导致数据丢失。建议保持开启。",
        "type": "bool",
        "default": true
      }
    }
  },
  "backup_settings": {
    "description": "定期备份",
    "hint": "每日自动备份记忆数据库，防止数据意外丢失",
    "type": "object",
    "items": {
      "enabled": {
        "description": "启用每日自动备份",
        "hint": "每日衰减任务执行后自动备份数据库。建议开启。",
        "type": "bool",
        "default": true
      },
      "keep_days": {
        "description": "备份保留天数",
        "hint": "超过该天数的旧备份文件将被自动删除。默认保留 7 天。",
        "type": "int",
        "default": 7
      }
    }
  },
  "forgetting_agent": {
    "description": "自动清理设置",
    "hint": "定期清理时间久远且重要性低的旧记忆，控制记忆库规模",
    "type": "object",
    "items": {
      "auto_cleanup_enabled": {
        "description": "启用每日自动清理",
        "hint": "每日重要性衰减后自动清理符合条件的旧记忆。",
        "type": "bool",
        "default": true
      },
      "cleanup_days_threshold": {
        "description": "清理天数阈值（天）",
        "hint": "记忆创建超过该天数后进入清理候选。需同时满足重要性低于阈值才会被删除。",
        "type": "int",
        "default": 30
      },
      "cleanup_importance_threshold": {
        "description": "清理重要性阈值",
        "hint": "重要性低于该值的旧记忆才会被清理。0.3 表示重要性低于 30% 的记忆。",
        "type": "float",
        "default": 0.3
      }
    }
  },
  "sparse_retriever": {
    "description": "BM25 关键词检索",
    "hint": "基于关键词匹配的稀疏检索，与向量检索互补",
    "type": "object",
    "items": {
      "enabled": {
        "description": "启用 BM25 检索",
        "hint": "关闭后只使用向量检索，关键词匹配能力会下降。建议保持开启。",
        "type": "bool",
        "default": true
      },
      "bm25_k1": {
        "description": "词频饱和度 (k1)",
        "hint": "控制词频对得分的影响上限。值越大高频词权重增长越慢。推荐 0.9-2.0，默认 1.2。",
        "type": "float",
        "default": 1.2
      },
      "bm25_b": {
        "description": "长度归一化 (b)",
        "hint": "控制文档长度对得分的影响。0 不归一化，1 完全归一化。推荐 0.5-0.9，默认 0.75。",
        "type": "float",
        "default": 0.75
      },
      "use_chinese_tokenizer": {
        "description": "启用中文分词",
        "hint": "使用 jieba 进行中文分词，提升中文检索效果。关闭后使用空格分词。",
        "type": "bool",
        "default": true
      },
      "enable_stopwords_filtering": {
        "description": "启用停用词过滤",
        "hint": "过滤「的」「了」等无意义词，提升检索精度。",
        "type": "bool",
        "default": true
      },
      "stopwords_source": {
        "description": "停用词表来源",
        "hint": "选择内置停用词表：hit（哈工大）、baidu（百度）、cn（通用中文）。",
        "type": "string",
        "default": "hit"
      },
      "custom_stopwords": {
        "description": "自定义停用词",
        "hint": "额外的停用词，用逗号或空格分隔，与所选停用词表合并使用。",
        "type": "string",
        "default": ""
      }
    }
  },
  "dense_retriever": {
    "description": "向量语义检索",
    "hint": "基于向量嵌入的语义相似度检索",
    "type": "object",
    "items": {
      "enable_query_preprocessing": {
        "description": "启用查询预处理",
        "hint": "对检索查询进行预处理（去除特殊字符等），提升向量检索稳定性。建议开启。",
        "type": "bool",
        "default": true
      }
    }
  }
}
