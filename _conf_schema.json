{
  "provider_settings": {
    "description": "模型提供商设置",
    "hint": "配置记忆系统使用的 AI 模型提供商",
    "type": "object",
    "items": {
      "embedding_provider_id": {
        "description": "向量嵌入提供商 ID",
        "hint": "用于生成记忆向量的 Embedding Provider ID。留空则使用 AstrBot 默认配置。请在 AstrBot 后台的「LLM 配置」中查看已配置的 Embedding Provider ID（如 openai_embedding、zhipu_embedding 等）。建议使用专门的嵌入模型以获得更好的语义检索效果。",
        "type": "string",
        "default": ""
      },
      "llm_provider_id": {
        "description": "大语言模型提供商",
        "hint": "用于总结对话历史和评估记忆重要性的 LLM Provider。留空则使用 AstrBot 默认配置。建议使用具有较强推理能力的模型（如 GPT-4、Claude 等）。",
        "type": "string",
        "_special": "select_provider",
        "default": ""
      }
    }
  },
  "webui_settings": {
    "description": "Web 管理面板配置",
    "hint": "配置插件自带的 Web 控制台，提供记忆和会话的可视化管理功能",
    "type": "object",
    "items": {
      "enabled": {
        "description": "启用 WebUI",
        "hint": "启用后可通过浏览器访问记忆管理面板。建议在需要频繁管理记忆时启用。",
        "type": "bool",
        "default": false
      },
      "host": {
        "description": "监听地址",
        "hint": "WebUI 服务监听的主机地址。使用 127.0.0.1 仅允许本地访问；使用 0.0.0.0 允许局域网访问。",
        "type": "string",
        "default": "127.0.0.1"
      },
      "port": {
        "description": "监听端口",
        "hint": "WebUI 服务监听端口。请确保端口未被占用，避免与 AstrBot 主端口（默认 6185）冲突。",
        "type": "int",
        "default": 8888
      },
      "access_password": {
        "description": "访问密码",
        "hint": "访问 WebUI 时需要输入的密码。强烈建议设置复杂密码以保护数据安全！留空时系统会随机生成一个密码并在日志中提示。",
        "type": "string",
        "obvious_hint": true,
        "default": ""
      },
      "session_timeout": {
        "description": "会话超时时间（秒）",
        "hint": "登录会话的有效时长。超过该时间需重新登录。建议设置为 3600（1小时）。",
        "type": "int",
        "default": 3600
      }
    }
  },
  "session_manager": {
    "description": "会话管理器配置",
    "hint": "管理用户会话状态和对话历史，支持持久化存储",
    "type": "object",
    "items": {
      "enable_full_group_capture": {
        "description": "捕获群聊全量消息",
        "hint": "是否捕获群聊中的所有消息（包括非@Bot消息）用于长期记忆。",
        "type": "bool",
        "default": true
      },
      "capture_image_caption": {
        "description": "写入图片描述到会话消息",
        "hint": "是否将 AstrBot 在请求中生成的 <image_caption> 写回本地会话消息，以便 pending 预览和自动总结保留图片语义。",
        "type": "bool",
        "default": true
      },
      "max_messages_per_session": {
        "description": "单会话最大消息数",
        "hint": "每个会话在本地消息库最多保留的消息数量。超过后仅删除已总结的旧消息，避免无限增长。",
        "type": "int",
        "default": 1000
      }
    }
  },
  "recall_engine": {
    "description": "记忆召回引擎配置",
    "hint": "负责智能检索和召回相关记忆",
    "type": "object",
    "items": {
      "top_k": {
        "description": "单次检索数量",
        "hint": "每次检索返回的最相关记忆数量。建议 3-10 之间。",
        "type": "int",
        "default": 5
      },
      "importance_weight": {
        "description": "记忆重要性权重",
        "hint": "用于混合评分中控制记忆重要性的占比。数值越大，重要性越影响排序。",
        "type": "float",
        "default": 1.0
      },
      "fallback_to_vector": {
        "description": "向量检索回退",
        "hint": "当混合/稀疏检索不可用或结果为空时，是否回退到纯向量检索。",
        "type": "bool",
        "default": true
      },
      "injection_method": {
        "description": "记忆注入方式",
        "hint": "控制记忆注入到 LLM 请求的位置。不同方式适合不同场景：system_prompt 适合作为背景知识，user_message_before 让 LLM 先看到记忆，user_message_after 将记忆作为补充信息。",
        "type": "string",
        "default": "user_message_before",
        "options": [
          "user_message_before",
          "system_prompt",
          "user_message_after"
        ]
      },
      "auto_remove_injected": {
        "description": "自动删除旧记忆片段",
        "hint": "在注入新记忆前，自动从 system_prompt 和对话历史中删除之前注入的记忆片段。强烈建议启用，避免记忆重复累积和 token 浪费。",
        "type": "bool",
        "default": true
      },
      "include_memory_time": {
        "description": "注入记忆带时间",
        "hint": "开启后，在注入给模型的记忆条目中显示记忆发生时间（格式：x年x月x日HH:MM）。",
        "type": "bool",
        "default": false
      }
    }
  },
  "importance_decay": {
    "description": "重要性衰减设置",
    "hint": "用于长期运行时逐步降低旧记忆的重要性，防止旧信息长期占据高权重",
    "type": "object",
    "items": {
      "decay_rate": {
        "description": "每日衰减率",
        "hint": "每自然日对记忆重要性进行的衰减比例。例如 0.01 表示每天降低 1%",
        "type": "float",
        "default": 0.01
      }
    }
  },
  "fusion_strategy": {
    "description": "结果融合策略",
    "hint": "用于多路检索结果的融合，目前内部固定为 RRF，仅开放 k 参数以调节融合强度",
    "type": "object",
    "items": {
      "rrf_k": {
        "description": "RRF 参数 k",
        "hint": "Reciprocal Rank Fusion 的 k 值，越小越强调排名靠前的结果。推荐 30-120",
        "type": "int",
        "default": 60
      }
    }
  },
  "filtering_settings": {
    "description": "过滤与隔离设置",
    "type": "object",
    "items": {
      "use_persona_filtering": {
        "description": "启用人格记忆过滤",
        "hint": "开启后，只会召回和总结与当前人格相关的记忆。",
        "type": "bool",
        "default": true
      },
      "use_session_filtering": {
        "description": "启用会话记忆隔离",
        "hint": "开启后，每个会话的记忆将是独立的。",
        "type": "bool",
        "default": true
      }
    }
  },
  "reflection_engine": {
    "description": "反思引擎设置",
    "hint": "负责生成和评估记忆",
    "type": "object",
    "items": {
      "summary_trigger_rounds": {
        "description": "总结触发轮次",
        "hint": "触发对话历史总结的对话轮次（一问一答为一轮）。",
        "type": "int",
        "default": 10
      },
      "save_original_conversation": {
        "description": "保存原始对话历史",
        "hint": "是否在记忆中同时保存原始对话内容和 LLM 生成的摘要。关闭（默认）时只保存结构化摘要（总结、主题、关键信息），可减少 60-80% 存储空间并提升检索效率。开启时会保存完整对话记录，适合需要完整上下文的场景或调试。",
        "type": "bool",
        "default": false
      },
      "enable_idle_auto_summary": {
        "description": "启用中断后自动总结",
        "hint": "开启后，当会话在一段时间内无新消息时，会自动归纳当前未总结的对话内容。",
        "type": "bool",
        "default": false
      },
      "idle_summary_timeout_seconds": {
        "description": "中断自动总结超时（秒）",
        "hint": "会话空闲达到该时长后，触发一次自动总结。建议 300-3600。",
        "type": "int",
        "default": 1800
      }
    }
  },
  "migration_settings": {
    "description": "数据库迁移设置",
    "hint": "控制数据库版本升级和自动迁移行为",
    "type": "object",
    "items": {
      "auto_migrate": {
        "description": "启用自动迁移",
        "hint": "插件启动时自动检测并执行数据库迁移。旧版本数据库将自动升级。",
        "type": "bool",
        "default": true
      },
      "create_backup": {
        "description": "迁移前自动备份",
        "hint": "执行数据库迁移前自动创建备份文件。",
        "type": "bool",
        "default": true
      }
    }
  },
  "forgetting_agent": {
    "description": "遗忘代理设置",
    "hint": "负责模拟遗忘，清理陈旧记忆",
    "type": "object",
    "items": {
      "cleanup_days_threshold": {
        "description": "清理天数阈值",
        "hint": "超过该天数的旧记忆将进入清理候选集合。",
        "type": "int",
        "default": 30
      },
      "cleanup_importance_threshold": {
        "description": "清理重要性阈值",
        "hint": "重要性低于该阈值的旧记忆将被删除。",
        "type": "float",
        "default": 0.3
      }
    }
  }
}
